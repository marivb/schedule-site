module = angular.module('organizer.main', ['organizer.sessions', 'organizer.factories'])

module.service 'ScheduleOrganizer', [
  'Schedule', 'scheduleId',
  (Schedule, scheduleId) ->
    @schedule = undefined
    @load = (callback) ->
      Schedule.get id: scheduleId, (schedule) ->
        for time in schedule.times
          time.session = { blank: true }
        @schedule = schedule
        callback(@schedule)

    return
]

module.service 'Editor', [
  'Sessions',
  (Sessions) ->
    currentlyEditting = undefined
    @editing = (time) ->
      time == currentlyEditting
    @edit = (time) ->
      currentlyEditting = time
    @clear = ->
      currentlyEditting = undefined

    return
]

module.controller 'OrganizeScheduleCtrl', [
  '$scope', 'scheduleId', 'ScheduleOrganizer', 'Sessions', 'Editor'
  ($scope, scheduleId, ScheduleOrganizer, Sessions, Editor) ->
    $scope.loadSchedule = ->
      ScheduleOrganizer.load (schedule) -> $scope.schedule = schedule
      $scope.sessions = Sessions.all
      $scope.editor = Editor

    $scope.addSessionToTime = (time, session) ->
      time.session = session
      Editor.clear()
    $scope.clear = (time) ->
      time.session = { blank: true }
      Editor.clear()
]
