module = angular.module('organizer.main', ['organizer.sessions'])

module.controller 'OrganizeScheduleCtrl', [
  '$scope', 'scheduleId', 'Schedule', 'Sessions',
  ($scope, scheduleId, Schedule, Sessions) ->
    $scope.loadSchedule = ->
      Schedule.get id: scheduleId, (schedule) ->
        for time in schedule.times
          time.session = { blank: true }
        $scope.schedule = schedule
      Sessions.load (sessions) -> $scope.sessions = sessions

    currentlyEditting = undefined
    $scope.editing = (time) -> time == currentlyEditting
    $scope.edit = (time) -> currentlyEditting = time
    $scope.addSessionToTime = (time, sessionId) ->
      time.session = $scope.sessions[sessionId]
      currentlyEditting = undefined
    $scope.clear = (time) ->
      time.session = { blank: true }
      currentlyEditting = undefined
]
